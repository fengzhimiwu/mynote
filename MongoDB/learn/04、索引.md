### 简介

在任何的数据库之中，索引都是一种提升数据库检索性能的手段，这一点在mongodb数据库之中同样是存在的，mongodb数据库里面依然会存在有两种的索引创建：一种是自动创建的，另外一种是手动创建的。

范例：重新准备一个新的简单集合

```
db.students.drop();
db.students.insert({"name": "张三", "sex": "男","age": 19,"score": 89,"address":"海淀区"});
```

此时在students集合上并没有去设置任何索引，那么下面通过getIndexes()来观察在students集合里面已经存在的索引内容。

```
db.students.getIndexes();
```

现在发现会存在有一个“_id”列的索引内容。但是如果要想创建自己的索引，则可以使用如下的语法：

- 索引创建：db.集合名称.ensureIndex({列: 1})
- - 设置的1 表示索引按照升序的方式进行排列，如果使用降序设置“-1”。

范例：创建一个索引，在age字段上设置一个降序索引；

```
db.students.ensureIndex({"age": -1});
```

此时并没有设置索引的名字，所以名字是自动命名的。

命名规范：“字段名称_索引的排序模式”。

范例：针对于当前的age字段上的索引做一个分析

```
db.students.find({"age": 19}).explain();
```

此时的查询使用了索引的技术，但是下面再来观察一个查询，不使用索引字段。

范例：针对于score字段上设置查询

```
db.students.find({"age": {"$eq": 19}});
db.students.find({"score": {"$gt": 60}}).explain();
```

此时在score字段上并没有设置索引，所以当前的索引形式就变为了全集扫描的模式。

但是如果说，现在换一种形式，年龄和成绩一起执行判断查询？

```
db.students.find({"$or": [
	{"age": {"$gt": 19}},
	{"score": {"$gt": 60}}
]}).explain();
```

这个时候虽然age字段上存在有索引，但是一个明显的问题是，由于score字段上没有索引，所以依然使用的是全表扫描操作，那么为了解决此时的问题，可以使用一个复合索引。

```
db.students.ensureIndex({"age": -1, "score": -1}, {"name": "age_-1_score_-1_index"});
```

范例：默认使用索引

```
db.students.find({"age": 19,"score":89}).explain();
```

现在发现并没有使用索引，所以这个时候看能否强制使用一次索引。hint()函数为强制使用索引操作。

范例：强制使用索引

```
db.students.find("$or": [
	{"age": {"$gt": 19}},
	{"score": {"$gt": 60}}
]).hint({"age": -1, "score";-1}).explain();
```

如果正常来讲，这个代码根本不可能调用默认的索引执行，但是我们觉得不好，索引需要使用hint()函数来强制使用mongodb使用一次索引，由于此时在age和score两个字段上已经设置了复合索引，那么现在使用的就是默认的复合索引。

但是如果在一个集合里面设置了过多的索引，实际上会导致性能下降，那么就可以删除索引。

范例：删除一个索引

```
db.students.dropIndex({"age": -1, "score": -1});
```

可是如果只是一个一个删除索引也会很麻烦，所以提供有删除全部索引的操作。

范例：删除全部索引

```
db.students.dropIndexes();
```

所谓的删除全部索引指的就是非“_id”的索引，所有的自定义索引。



### 唯一索引

唯一索引的主要目的是用在某一个字段上，使该字段的内容不重复。

范例：创建唯一索引

```
db.students.ensureIndex({"name": 1}, {"unique": true});
```

在name字段上的内容绝对不允许重复。

范例：在students集合里面增加重复的数据

```
db.students.insert({"name": "张三", "age": 19})
```

此时除了name字段上的内容之外，发现所有的数据都不一样，但是由于在name字段上设置了唯一索引，所以真个程序里面如果增加了重复内容，那么会出现以下错误提示信息。

E11000 duplicate key error index:



### 过期索引

